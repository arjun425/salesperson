{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/redaj/my-next-website/src/app/scan/update/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Quagga from \"quagga\";\r\nimport { collection, getDocs, addDoc, updateDoc, doc } from \"firebase/firestore\";\r\nimport { db } from \"@/firebase/firebase\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst ScanUpdatePage = () => {\r\n  const [barcode, setBarcode] = useState(\"\");\r\n  const [productName, setProductName] = useState(\"\"); // When saved, productName is stored in all caps\r\n  const [pricePerUnit, setPricePerUnit] = useState(\"\");\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [scanned, setScanned] = useState(false);\r\n  const [confirmVisible, setConfirmVisible] = useState(false);\r\n  const [existingProduct, setExistingProduct] = useState(null);\r\n\r\n  // Override console.error to suppress errors that include \"reading 'data'\"\r\n  useEffect(() => {\r\n    const originalConsoleError = console.error;\r\n    console.error = (...args) => {\r\n      if (\r\n        args[0] &&\r\n        typeof args[0] === \"string\" &&\r\n        args[0].includes(\"reading 'data'\")\r\n      ) {\r\n        return;\r\n      }\r\n      originalConsoleError(...args);\r\n    };\r\n    return () => {\r\n      console.error = originalConsoleError;\r\n    };\r\n  }, []);\r\n\r\n  // Global error handler as an extra layer.\r\n  useEffect(() => {\r\n    const handleGlobalError = (event) => {\r\n      if (\r\n        event.error &&\r\n        event.error.message &&\r\n        event.error.message.includes(\"reading 'data'\")\r\n      ) {\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"error\", handleGlobalError);\r\n    return () => {\r\n      window.removeEventListener(\"error\", handleGlobalError);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const scannerContainer = document.getElementById(\"barcode-scanner-update\");\r\n    if (!scannerContainer) return;\r\n\r\n    if (!scanned) {\r\n      Quagga.init(\r\n        {\r\n          inputStream: {\r\n            type: \"LiveStream\",\r\n            target: scannerContainer,\r\n            constraints: {\r\n              width: 640,\r\n              height: 480,\r\n              facingMode: \"environment\",\r\n            },\r\n          },\r\n          decoder: {\r\n            readers: [\"ean_reader\", \"code_128_reader\"],\r\n          },\r\n        },\r\n        (err) => {\r\n          if (err) {\r\n            console.error(\"Error initializing Quagga:\", err);\r\n            toast.error(\"Error initializing scanner: \" + err.message);\r\n            return;\r\n          }\r\n          Quagga.start();\r\n        }\r\n      );\r\n\r\n      Quagga.onDetected(async (result) => {\r\n        try {\r\n          const detectedCode = result.codeResult.code;\r\n          if (!scanned) {\r\n            setBarcode(detectedCode);\r\n            setScanned(true);\r\n            Quagga.stop();\r\n            // Check if product already exists in Firestore.\r\n            const productsRef = collection(db, \"inventory\");\r\n            try {\r\n              const querySnapshot = await getDocs(productsRef);\r\n              let foundProduct = null;\r\n              for (const docSnapshot of querySnapshot.docs) {\r\n                if (!docSnapshot) continue; // Defensive check\r\n                const data = docSnapshot.data();\r\n                if (data && data.barcode === detectedCode) {\r\n                  // Store the document id along with the data.\r\n                  foundProduct = { id: docSnapshot.id, ...data };\r\n                  break;\r\n                }\r\n              }\r\n              if (foundProduct) {\r\n                setExistingProduct(foundProduct);\r\n                setProductName(foundProduct.productName || \"\");\r\n                setPricePerUnit(foundProduct[\"price per unit\"]?.toString() || \"\");\r\n              } else {\r\n                setExistingProduct(null);\r\n                setProductName(\"\");\r\n                setPricePerUnit(\"\");\r\n              }\r\n            } catch (error) {\r\n              toast.error(\"Error checking product: \" + error.message);\r\n            }\r\n            setConfirmVisible(true);\r\n          }\r\n        } catch (error) {\r\n          console.warn(\"Benign error in onDetected handler:\", error);\r\n        }\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      try {\r\n        if (Quagga && typeof Quagga.offDetected === \"function\") {\r\n          Quagga.offDetected();\r\n          Quagga.stop();\r\n        }\r\n      } catch (error) {\r\n        console.warn(\"Error during Quagga cleanup:\", error);\r\n      }\r\n    };\r\n  }, [scanned]);\r\n\r\n  const handleSaveProduct = async () => {\r\n    if (!barcode) {\r\n      toast.error(\"Barcode is missing. Please scan again.\");\r\n      return;\r\n    }\r\n    if (!existingProduct) {\r\n      if (\r\n        !productName.trim() ||\r\n        !pricePerUnit.toString().trim() ||\r\n        quantity <= 0\r\n      ) {\r\n        toast.error(\r\n          \"Please enter valid product details (name, price per unit, and quantity).\"\r\n        );\r\n        return;\r\n      }\r\n    } else {\r\n      if (quantity <= 0) {\r\n        toast.error(\"Please enter a valid quantity.\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    try {\r\n      const productsRef = collection(db, \"inventory\");\r\n      if (existingProduct) {\r\n        if (!existingProduct.id) {\r\n          toast.error(\"Error: Existing product has no valid ID.\");\r\n          return;\r\n        }\r\n        console.log(\"Updating product:\", existingProduct);\r\n        const newQuantity = (existingProduct.quantity || 0) + quantity;\r\n        await updateDoc(doc(db, \"inventory\", existingProduct.id), {\r\n          quantity: newQuantity,\r\n        });\r\n        toast.success(\"Product quantity updated successfully!\");\r\n      } else {\r\n        await addDoc(productsRef, {\r\n          barcode,\r\n          productName: productName.toUpperCase(), // Convert to all caps here\r\n          \"price per unit\": parseFloat(pricePerUnit),\r\n          quantity,\r\n        });\r\n        toast.success(\"New product added successfully!\");\r\n      }\r\n      // Reset state for the next scan.\r\n      setBarcode(\"\");\r\n      setProductName(\"\");\r\n      setPricePerUnit(\"\");\r\n      setQuantity(1);\r\n      setScanned(false);\r\n      setConfirmVisible(false);\r\n      setExistingProduct(null);\r\n      try {\r\n        Quagga.start();\r\n      } catch (e) {\r\n        if (e && e.message && e.message.includes(\"reading 'data'\")) {\r\n          // Suppress this error.\r\n        } else {\r\n          console.error(e);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating inventory:\", error);\r\n      toast.error(\"Error updating inventory: \" + error.message);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen\" style={{ fontFamily: \"Arvo\" }}>\r\n      {/* Header Section */}\r\n      <header className=\"bg-blue-700 text-white py-4 px-6 flex items-center\">\r\n        <img\r\n          src=\"/logo.ico\"\r\n          alt=\"Logo\"\r\n          className=\"w-10 h-10 mr-4 object-contain\"\r\n        />\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold uppercase\">ShopKeeper</h1>\r\n          <p className=\"text-sm\">You are updating your inventory</p>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Body Section */}\r\n      <main className=\"bg-white-500 flex flex-col items-center py-10\">\r\n        <div\r\n          className=\"mb-8\"\r\n          id=\"barcode-scanner-update\"\r\n          style={{ width: 320, height: 240, backgroundColor: \"#000\" }}\r\n        ></div>\r\n        {barcode && <p className=\"mb-4 text-lg\">Scanned Barcode: {barcode}</p>}\r\n        {confirmVisible && (\r\n          <div className=\"flex flex-col gap-3 w-80 bg-white p-4 rounded shadow\">\r\n            {existingProduct ? (\r\n              <>\r\n                <p className=\"text-lg\">Product Name: {productName}</p>\r\n                <p className=\"text-lg\">Price Per Unit: {pricePerUnit}</p>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter Product Name\"\r\n                  value={productName}\r\n                  onChange={(e) => setProductName(e.target.value)}\r\n                  className=\"p-2 border rounded\"\r\n                />\r\n                <input\r\n                  type=\"number\"\r\n                  placeholder=\"Enter Price Per Unit\"\r\n                  value={pricePerUnit}\r\n                  onChange={(e) => setPricePerUnit(e.target.value)}\r\n                  className=\"p-2 border rounded\"\r\n                />\r\n              </>\r\n            )}\r\n            <input\r\n              type=\"number\"\r\n              placeholder=\"Enter Quantity\"\r\n              value={quantity}\r\n              onChange={(e) => setQuantity(Number(e.target.value))}\r\n              className=\"p-2 border rounded\"\r\n            />\r\n            <button\r\n              onClick={handleSaveProduct}\r\n              className=\"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition transform hover:scale-105\"\r\n            >\r\n              Confirm & Save\r\n            </button>\r\n          </div>\r\n        )}\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ScanUpdatePage;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 403, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}